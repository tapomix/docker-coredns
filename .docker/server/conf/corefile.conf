# CoreDNS Configuration

# ==============================================================================
# All domains handled by this server
# ==============================================================================
import domains/*.conf

# ==============================================================================
# Recursive resolver for external domains (forward)
# ==============================================================================
. {
    # ACL: Only allow queries from localhost and local networks
    # Prevents becoming an open resolver (security!)
    acl {
        allow net 127.0.0.0/8 ::1/128                     # Localhost
        allow net 10.0.0.0/8 172.16.0.0/12 192.168.0.0/16 # Private networks
        block                                             # Block everyone else
    }

    # Forward to secure DNS providers (DNS-over-TLS)
    forward . tls://1.1.1.3 tls://1.0.0.3 {
        tls_servername cloudflare-dns.com
        health_check 30s
    }

    # Hide server version
    # Query to test : dig CH TXT version.bind @127.0.0.1 +short
    chaos "DNS"

    # Setup cache + logs
    import cache-logs.conf

    # Health and readiness endpoints
    health :8080
    ready :8181
}
